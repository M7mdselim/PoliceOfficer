USE [PoliceOfficerDB]
GO
/****** Object:  UserDefinedFunction [dbo].[NormalizeArabicText]    Script Date: 27/08/2025 20:38:59 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[NormalizeArabicText] (@text NVARCHAR(MAX))
RETURNS NVARCHAR(MAX)
AS
BEGIN
    -- Replace different forms of Arabic characters with their normalized forms
    RETURN REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(
        @text,
        N'أ', N'ا'),   -- Normalize 'أ' to 'ا'
        N'إ', N'ا'),   -- Normalize 'إ' to 'ا'
        N'آ', N'ا'),   -- Normalize 'آ' to 'ا'
        N'ى', N'ي'),   -- Normalize 'ى' to 'ي'
        N'ئ', N'ي'),   -- Normalize 'ئ' to 'ي'
        N'ة', N'ه')    -- Normalize 'ة' to 'ه'
END
GO
/****** Object:  UserDefinedFunction [dbo].[ReverseNormalizeArabicText]    Script Date: 27/08/2025 20:38:59 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[ReverseNormalizeArabicText] (@text NVARCHAR(MAX))
RETURNS NVARCHAR(MAX)
AS
BEGIN
    -- Replace normalized characters with their original forms
    RETURN REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(
        @text,
        N'ا', N'أ'),   -- Reverse normalize 'ا' to 'أ'
        N'ا', N'إ'),   -- Reverse normalize 'ا' to 'إ'
        N'ا', N'آ'),   -- Reverse normalize 'ا' to 'آ'
        N'ي', N'ى'),   -- Reverse normalize 'ي' to 'ى'
        N'ي', N'ئ'),   -- Reverse normalize 'ي' to 'ئ'
        N'ه', N'ة')    -- Reverse normalize 'ه' to 'ة'
END
GO
/****** Object:  Table [dbo].[Prisoner]    Script Date: 27/08/2025 20:39:00 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Prisoner](
	[PrisonerID] [int] IDENTITY(1,1) NOT NULL,
	[PrisonerInfoID] [int] NOT NULL,
	[FullName] [nvarchar](100) NOT NULL,
	[ReservationNumber] [nvarchar](50) NOT NULL,
	[CaseID] [nvarchar](50) NOT NULL,
	[DangerousLevel] [nvarchar](20) NULL,
	[PrisonerStatus] [nvarchar](20) NULL,
	[Accused] [nvarchar](200) NULL,
	[PrinciplesType] [nvarchar](50) NULL,
	[ServiceTime] [nvarchar](50) NULL,
	[HospitalDate] [date] NULL,
	[LeaveDate] [date] NULL,
	[NIDNumber] [nvarchar](20) NULL,
	[CriminalRecord] [nvarchar](max) NULL,
	[ImprisonmentDetails] [nvarchar](max) NULL,
	[SecurityRevealed] [nvarchar](max) NULL,
	[CensorshipInfo] [nvarchar](max) NULL,
	[Notes] [nvarchar](max) NULL,
	[CreatedDate] [datetime] NULL,
	[LastModified] [datetime] NULL,
	[CreatedBy] [nvarchar](50) NULL,
	[ModifiedBy] [nvarchar](50) NULL,
PRIMARY KEY CLUSTERED 
(
	[PrisonerID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  View [dbo].[vw_PrisonerReport]    Script Date: 27/08/2025 20:39:00 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[vw_PrisonerReport]
AS
SELECT
    PrisonerID,
    FullName,
    ReservationNumber,
    CaseID,
    DangerousLevel,
    PrisonerStatus,
    Accused,
    PrinciplesType,
    ServiceTime,
    HospitalDate,
    LeaveDate,
    NIDNumber,
    CriminalRecord,
    ImprisonmentDetails,
    SecurityRevealed,
    CensorshipInfo,
    Notes,
    CreatedDate,
    LastModified,
    CreatedBy,
    ModifiedBy
FROM Prisoner

UNION ALL

SELECT
    NULL AS PrisonerID,
    'Total Prisoners' AS FullName,
    NULL AS ReservationNumber,
    NULL AS CaseID,
    NULL AS DangerousLevel,
    NULL AS PrisonerStatus,
    NULL AS Accused,
    NULL AS PrinciplesType,
    NULL AS ServiceTime,
    NULL AS HospitalDate,
    NULL AS LeaveDate,
    NULL AS NIDNumber,
    NULL AS CriminalRecord,
    NULL AS ImprisonmentDetails,
    NULL AS SecurityRevealed,
    NULL AS CensorshipInfo,
    NULL AS Notes,
    NULL AS CreatedDate,
    NULL AS LastModified,
    NULL AS CreatedBy,
    NULL AS ModifiedBy
GO
/****** Object:  Table [dbo].[CashierDetails]    Script Date: 27/08/2025 20:39:00 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CashierDetails](
	[CashierID] [int] IDENTITY(1,1) NOT NULL,
	[Username] [nvarchar](50) NOT NULL,
	[PasswordHash] [nvarchar](50) NOT NULL,
	[RoleID] [int] NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[CashierID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[Username] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PrisonerInfo]    Script Date: 27/08/2025 20:39:00 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PrisonerInfo](
	[PrisonerInfoID] [int] IDENTITY(1,1) NOT NULL,
	[FullName] [nvarchar](100) NOT NULL,
	[NIDNumber] [nvarchar](20) NOT NULL,
	[DangerousLevel] [nvarchar](20) NULL,
	[PrisonerStatus] [nvarchar](20) NULL,
	[CreatedDate] [datetime] NULL,
	[LastModified] [datetime] NULL,
	[CreatedBy] [nvarchar](50) NULL,
	[ModifiedBy] [nvarchar](50) NULL,
PRIMARY KEY CLUSTERED 
(
	[PrisonerInfoID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[NIDNumber] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Roles]    Script Date: 27/08/2025 20:39:00 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Roles](
	[RoleID] [int] IDENTITY(1,1) NOT NULL,
	[RoleName] [nvarchar](50) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[RoleID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[RoleName] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER TABLE [dbo].[CashierDetails] ADD  DEFAULT ((1)) FOR [RoleID]
GO
ALTER TABLE [dbo].[Prisoner] ADD  DEFAULT (getdate()) FOR [CreatedDate]
GO
ALTER TABLE [dbo].[Prisoner] ADD  DEFAULT (getdate()) FOR [LastModified]
GO
ALTER TABLE [dbo].[PrisonerInfo] ADD  DEFAULT (getdate()) FOR [CreatedDate]
GO
ALTER TABLE [dbo].[PrisonerInfo] ADD  DEFAULT (getdate()) FOR [LastModified]
GO
ALTER TABLE [dbo].[CashierDetails]  WITH CHECK ADD FOREIGN KEY([RoleID])
REFERENCES [dbo].[Roles] ([RoleID])
GO
ALTER TABLE [dbo].[CashierDetails]  WITH CHECK ADD FOREIGN KEY([RoleID])
REFERENCES [dbo].[Roles] ([RoleID])
GO
ALTER TABLE [dbo].[Prisoner]  WITH CHECK ADD  CONSTRAINT [FK_Prisoner_PrisonerInfo] FOREIGN KEY([PrisonerInfoID])
REFERENCES [dbo].[PrisonerInfo] ([PrisonerInfoID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Prisoner] CHECK CONSTRAINT [FK_Prisoner_PrisonerInfo]
GO


GO
